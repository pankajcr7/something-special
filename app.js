// ===== DATABASE =====
const DB={pickup:{smooth:{mild:["Do you have a map? Because I just got lost in your eyes.","I must be a snowflake, because I've fallen for you.","Are you a parking ticket? Because you've got 'fine' written all over you.","Is your name Google? Because you have everything I've been searching for.","I'd say God bless you, but it looks like he already did.","If you were a vegetable, you'd be a cute-cumber.","Excuse me, but I think you dropped something: my jaw.","Do you believe in love at first sight, or should I walk by again?","Are you a campfire? Because you're hot and I want s'more.","I'm not a photographer, but I can picture us together."],bold:["If beauty were time, you'd be an eternity.","I'm not a genie, but I can make your dreams come true.","You must be tired because you've been running through my mind all day.","Is it hot in here or is it just you?","I'd never play hide and seek with you ‚Äî someone like you is impossible to find.","Your hand looks heavy. Let me hold it for you.","They say nothing lasts forever ‚Äî want to be my nothing?","I was going to say something really sweet about you, but when I saw you, I became speechless.","You must be a ninja, because you snuck into my heart.","You're like Wi-Fi ‚Äî I'm feeling a connection."],extreme:["I think God was showing off when He made you.","If kisses were snowflakes, I'd send you a blizzard.","Are you made of copper and tellurium? Because you're Cu-Te.","I'd rearrange the alphabet to put U and I together.","I must be a light switch, because you turn me on.","Do you have a sunburn, or are you always this hot?","I'm no organ donor, but I'd give you my heart.","Are you a time traveler? Because I see you in my future.","Somebody better call God, because he's missing an angel.","You don't need keys to drive me crazy."]},funny:{mild:["Are you a banana? Because I find you a-peeling!","I'm not a mathematician, but I think we're a perfect equation.","Do you have a name, or can I call you mine?","Are you from Tennessee? Because you're the only ten I see!","Do you like raisins? How about a date?","If you were a chicken, you'd be impeccable.","I must be a broom because I just swept you off my feet.","You must be made of cheese because you're looking gouda tonight.","Are you a keyboard? Because you're just my type.","Do you have a Band-Aid? Because I just scraped my knee falling for you."],bold:["Are you an alien? Because you just abducted my heart.","My love for you is like diarrhea ‚Äî I can't hold it in.","Are you a magician? Every time I look at you, everyone else disappears.","If you were a booger, I'd pick you first.","I'm not drunk, I'm just intoxicated by you.","Feel my shirt ‚Äî know what it's made of? Boyfriend material.","I'm on top of things. Would you like to be one of them?","Did you sit in sugar? Because you've got a pretty sweet butt.","You must be a campfire, because you're making me hot and I want s'more.","Is your dad a boxer? Because you're a total knockout!"],extreme:["If I could rearrange the alphabet, I'd put U and I in a bed together.","My name might not be Luna, but I sure can make your night magical.","Are you an exam? Because I've been studying you all night.","I'm not a weatherman, but you can expect a few inches tonight.","The word of the day is 'legs' ‚Äî let's go to my place and spread the word.","Are you my appendix? Because I have this funny feeling in my stomach that makes me want to take you out.","You're so hot, you denature my proteins.","Is your name Chapstick? Because you're da balm!","I'd like to take you to the movies, but they don't let you bring your own snacks.","You're so sweet you're giving me a toothache."]},romantic:{mild:["I didn't believe in love at first sight until I saw you.","Your smile is like sunshine on a rainy day.","In a room full of art, I'd still stare at you.","I think the sun is jealous of the way you shine.","I wonder if you know how beautiful you look right now.","Every love story is special, but ours would be my favorite.","You make me want to be a better person.","Your eyes are like stars ‚Äî I could stare at them all night.","Meeting you feels like a breath of fresh air.","You're the kind of beautiful that doesn't need makeup."],bold:["If I had a flower for every time you made me smile, I'd have a garden.","I've been thinking about you more than I should, but less than you deserve.","My heart skips a beat every time I see your name pop up.","You don't just cross my mind ‚Äî you live in it.","They say don't mix business with pleasure, but you're all pleasure.","I want to be the reason you look at your phone and smile.","If beauty were a crime, you'd be serving a life sentence.","I didn't plan on falling for anyone today, but you changed my mind.","Your voice is my favorite sound, and your name is my favorite word.","I could talk to you for hours and it would still feel like minutes."],extreme:["I want to wake up next to you every morning for the rest of my life.","You're not just my dream girl ‚Äî you're my everything.","I'd cross oceans for you. I'd move mountains for you. I'd do anything for you.","My heart wasn't complete until I found you.","You're the first thing I think about when I wake up and the last thing on my mind before I sleep.","If I could have anyone in the world, I'd still choose you.","I don't need paradise because I found you. I don't need dreams because I already have you.","You're the poem I never knew how to write.","I fell in love the way you fall asleep ‚Äî slowly, and then all at once.","Every moment with you feels like a beautiful dream I never want to wake up from."]},bold:{mild:["I'm not usually this forward, but you're worth the risk.","You caught my eye, and I had to come say hi.","I don't know what it is about you, but I can't look away.","Something tells me you're worth getting to know.","I've got a feeling you and I could have some fun together."],bold:["You look like you could use some good company.","I'm not shy, and I think you're absolutely stunning.","I'd be lying if I said I wasn't attracted to you.","Let's skip the small talk ‚Äî want to go on an adventure?","I've been told I'm pretty charming. Want to find out?"],extreme:["I want you. No games, no filters. Just you.","I can't stop thinking about you and honestly I don't want to.","You make my heart race and I barely know you.","I've never wanted someone this bad before.","Everything about you drives me crazy ‚Äî in the best way."]},nerdy:{mild:["Are you a 45-degree angle? Because you're acute one!","You must be the square root of -1, because you can't be real.","Are you made of Fluorine, Iodine, and Neon? Because you're F-I-Ne.","You're hotter than the bottom of my laptop.","I think you're the CSS to my HTML."],bold:["Are you a black hole? Because you just pulled me in.","I think we have great chemistry ‚Äî shall we test it?","You must be a neurotransmitter because you make my heart race.","Like a quantum state, I can't stop observing you.","You've got 11 out of 10 bits in my attractiveness register."],extreme:["I'll be the semicolon to your code ‚Äî you can't function without me.","Are you garbage collection? Because you make my heart stop.","My love for you is like a while(true) loop ‚Äî it never ends.","You overload my operators and override my methods.","You're the bug in my code ‚Äî I just can't get you out of my head."]},poetic:{mild:["You are the poem I didn't know my heart was writing.","If grace had a face, I think it would look like yours.","Your presence is a gentle storm I never want to end.","You are the first light in a sky full of stars.","Your smile is a verse I want to read forever."],bold:["I want to write every love poem with your name between the lines.","You are the ache in my chest that I never want to cure.","My soul knew you before my eyes ever did.","You make the dark feel less heavy.","Every second away from you feels like a sentence."],extreme:["I would burn the world to ashes just to write your name in them.","You are my ruin and my salvation.","I don't need heaven ‚Äî I've already touched divinity in you.","My love for you is the kind that poets die writing about.","You are the most beautiful catastrophe I've ever known."]}},reply:{smooth:{mild:["I'd say I'm surprised, but honestly, I saw this coming.","If flirting were a sport, you'd be a gold medalist.","Careful ‚Äî you keep talking like that and I might fall.","I appreciate the effort, but you had me at hello.","I was going to play hard to get, but then you made me smile."],bold:["You think you're smooth? Watch and learn.","I don't blush easily, but you might be the exception.","I'm not easy to impress, but you're making a strong case.","I wasn't planning on catching feelings today, but here we are.","You're dangerously good at this."],extreme:["Stop making me smile ‚Äî people are starting to notice.","I'm trying to play it cool, but you're making it impossible.","Keep talking like that and I'll have to marry you.","I've been hit with a lot of lines, but yours actually got me.","You're either a genius or a fool ‚Äî either way, I'm intrigued."]},funny:{mild:["I'd roast you, but my mama taught me not to burn trash.","That was cute, I'll give you a 6/10.","Was that a pickup line or a cry for help?","You're trying so hard it's almost adorable.","I'd ghost you but even my WiFi has better connections."],bold:["Nice try ‚Äî you almost made me feel something.","I'd swipe right on that line, ngl.","Did Google help you with that or are you naturally this smooth?","I laughed, but don't let that go to your head.","If I had a dollar for every line like that, I'd be broke ‚Äî that was original."],extreme:["That was so bad it circled back to being good.","I just snorted. Thanks for ruining my image.","Bro really said that with his whole chest üíÄ","I'm not sure if I should be impressed or concerned.","That line was illegal in 12 countries."]},romantic:{mild:["You always know the right thing to say.","That made my heart skip a little, not gonna lie.","Why do you have to be so sweet?","I'm smiling like an idiot because of you.","You make it hard to keep my guard up."],bold:["I wasn't ready for that. My heart just did a thing.","How do you always manage to make me feel this way?","You're the best thing that's happened to my inbox.","I think about you way more than I should admit.","Reading your texts is the highlight of my day."],extreme:["I literally held my phone to my chest after reading that.","You have my heart in your hands ‚Äî be careful with it.","I never believed in soulmates until you came along.","I'd choose you in every lifetime.","You're the reason I believe in love."]},bold:{mild:["Interesting approach. I respect the confidence.","Bold move ‚Äî let's see if you can keep up.","I like someone who doesn't beat around the bush.","That took guts. I'm mildly impressed.","You came in hot ‚Äî I respect it."],bold:["You've got my attention. Now what are you going to do with it?","Challenge accepted. Your move.","I don't know who gave you this confidence, but thank them.","Keep that energy ‚Äî I'm here for it.","Oh, you're dangerous. I like it."],extreme:["You just shifted the whole vibe. I'm locked in.","Nobody talks to me like that and gets away with it.","I'm either going to love you or destroy you. Maybe both.","You've got no idea what you just started.","Game on. But I should warn you ‚Äî I don't lose."]}},bio:{smooth:{mild:["Part-time dreamer, full-time good vibes only.","Coffee in one hand, confidence in the other.","Looking for someone to share sunsets and playlists with.","Simple. Honest. Down to earth. Maybe a little too cute.","Just someone who smiles a lot and means it."],bold:["I'm the main character, and this is my casting call.","Not here to play games ‚Äî unless it's Mario Kart.","If you can make me laugh, you've already won.","Professional overthinker. Amateur heart-stealer.","5'10 in shoes. 6'2 in confidence."],extreme:["You swiped right. Congratulations, your taste is impeccable.","Warning: may cause feelings you weren't prepared for.","I'm the vibe your ex couldn't match.","I'm not everyone's cup of tea ‚Äî I'm more like tequila.","You're not going to find someone like me. Don't let me go."]},funny:{mild:["Just here because my mom told me I'm a catch.","Will trade pickup lines for pizza.","Looking for someone to blame when I can't pick a restaurant.","I'm 99% funny and 1% serious about finding love.","Swipe right if you can name 3 dinosaurs."],bold:["I put the 'hot' in 'hot mess.'","I can cook minute rice in 58 seconds.","My love language is memes.","I'm basically a snack. A whole buffet, actually.","Dating me is like a rollercoaster ‚Äî terrifying but fun."],extreme:["My FBI agent thinks I'm hilarious.","I've been single long enough to know it's everyone else's fault.","I'm the reason they invented the 'unmatch' button.","If we match, I promise to be weirder than you.","Swipe right and let's be awkward together."]}},opener:{smooth:{mild:["Hey! Your profile caught my eye ‚Äî what's the story behind your first photo?","I noticed we both like the same things ‚Äî what got you into it?","If your personality is half as great as your smile, I'm in trouble.","Okay, I need to know ‚Äî are you a morning person or a night owl?","I'm curious ‚Äî what's the best trip you've ever taken?"],bold:["I swiped right so fast I think I broke my phone.","I'll shoot my shot ‚Äî are you always this stunning?","I have a feeling we'd get along. Want to prove me right?","Let's skip the boring 'hey' stage. Tell me your hot take.","Something about you stood out ‚Äî and I had to say hi."],extreme:["I'm going to be bold ‚Äî I think we'd be amazing together.","Every time I type something, I delete it because nothing seems good enough.","I think this is the start of something really good.","I don't message first often ‚Äî you should feel special.","I'm not great at opening lines, but I'm great at showing up."]},funny:{mild:["On a scale of 1 to 10, you're a 9 ‚Äî and I'm the 1 you need.","I've been staring at your profile for 5 min trying to be clever. This is it.","Hey! Just wanted to say‚Ä¶ I forgot. You're distracting.","If you were a fruit, you'd be a fineapple.","Do you like science? Because we've got chemistry."],bold:["I was going to send a cheesy line, but you deserve something gouda.","Let's be honest ‚Äî we both swiped right. Now what?","My friend dared me to message you. Thank them later.","I'm not saying I'm Batman, but have you ever seen us in the same room?","I just flipped a coin. Both sides say you should reply."]}},compliment:{smooth:{mild:["You have the kind of smile that makes the whole room brighter.","There's something about you that's magnetic.","You carry yourself with such grace.","You have a really kind energy.","I love the way your eyes light up when you talk."],bold:["Whoever ends up with you is the luckiest person alive.","You're the kind of beautiful that takes breath away.","There's something effortlessly stunning about you.","I've never met anyone who radiates so much warmth.","You have this presence that makes people want to be near you."],extreme:["Honestly, you're the most beautiful person I've ever seen.","You redefine what it means to be attractive.","I could look at you forever and never get tired.","You're not just beautiful ‚Äî you're unforgettable.","God really spent extra time on you."]}},roast:{smooth:{mild:["You're like a software update ‚Äî whenever I see you, I think 'not now.'","You bring everyone so much joy... when you leave.","You're proof that even Google can't find everything.","If you were any more basic, you'd be a pH 14.","I'd explain it to you, but I left my crayons at home."],bold:["I'd give you a nasty look, but you've already got one.","You're not stupid; you just have bad luck thinking.","You're like a cloud ‚Äî everything brightens when you disappear.","I'd roast you but I don't want to burn the trash.","I've seen sharper minds in a bowl of soup."],extreme:["If laughter is the best medicine, your face must be curing the world.","You're living proof that evolution makes mistakes.","I'd insult you, but nature already did.","If your brain was dynamite, there wouldn't be enough to blow your hat off.","Your secrets are always safe with me. I never listen when you tell me."]}},goodnight:{smooth:{mild:["Goodnight! Sweet dreams and all that cute stuff üåô","Sleep tight ‚Äî don't let the bed bugs bite!","Nighty night! Dream something fun tonight üí§","Rest well ‚Äî you deserve it after being amazing today.","Sending you sleepy vibes and warm blanket energy üõèÔ∏è"],bold:["Can't sleep yet because someone won't leave my mind. It's you.","Goodnight. Try not to dream about me... actually, go ahead üòè","Last text of the night, and it's for you. Sleep well.","I'd say sweet dreams, but you're already the sweetest dream I know.","Close your eyes. Imagine me telling you this in person. Goodnight üíú"],extreme:["I wish I could kiss you goodnight right now.","Falling asleep thinking about you has become my favorite routine.","One day, 'goodnight' won't mean goodbye ‚Äî it'll mean 'see you in the morning.'","You're my last thought tonight, and honestly, every night.","You're the most beautiful part of my day. Goodnight."]}},goodmorning:{smooth:{mild:["Good morning! Hope your day is as awesome as you are ‚òÄÔ∏è","Rise and shine! The world is lucky to have you today.","Morning! Here's your daily reminder that you're amazing.","Good morning! Sending you good vibes and good coffee ‚òï","New day, new chances to be awesome. Let's go!"],bold:["Good morning, beautiful. You woke up on my mind again.","Just so you know ‚Äî you're the first person I thought about today.","Morning! You were running through my dreams all night.","You make mornings worth waking up for.","Good morning to the reason I check my phone first thing üòè"],extreme:["I want you to be my first 'good morning' and last 'goodnight' ‚Äî forever.","Waking up knowing you exist is the best feeling.","Good morning, my love. I hope your day is half as beautiful as you.","I dreamed of you last night. Waking up was even better.","Every sunrise reminds me of you ‚Äî beautiful, warm, impossible to look away from."]}}};

const _g=['gsk_2oDA7','TXmZY4Nbr','S4DZFjWGdy','b3FYnKvfx3','Man4P79WIR','J2xGprXX'];
const GROQ_KEY=_g.join('');
const GEMINI_KEY='';
const providers=[
{name:'Groq',enabled:()=>!!GROQ_KEY,call:async(msgs)=>{const res=await fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${GROQ_KEY}`},body:JSON.stringify({model:'llama-3.3-70b-versatile',messages:msgs,temperature:1.0,max_tokens:1024})});if(!res.ok)throw new Error(`Groq ${res.status}`);const d=await res.json();return d?.choices?.[0]?.message?.content||'';}},
{name:'Gemini',enabled:()=>!!GEMINI_KEY,call:async(msgs)=>{const last=msgs[msgs.length-1]?.content||'';const res=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_KEY}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:last}]}]})});if(!res.ok)throw new Error(`Gemini ${res.status}`);const d=await res.json();return d?.candidates?.[0]?.content?.parts?.[0]?.text||'';}}
];

let category='pickup',style='smooth',lang='hinglish',intensity='bold';
let favorites=JSON.parse(localStorage.getItem('rizzFavs')||'[]');
let historyArr=JSON.parse(localStorage.getItem('rizzHistory')||'[]');
let soundEnabled=JSON.parse(localStorage.getItem('rizzSound') ?? 'true');
let lightMode=JSON.parse(localStorage.getItem('rizzLight') ?? 'false');
let battleStats=JSON.parse(localStorage.getItem('rizzBattle')||'{"total":0}');
let challengeData=JSON.parse(localStorage.getItem('rizzChallenge')||'{}');

// ===== SOUND SYSTEM =====
let audioCtx;
function getAudioCtx(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();return audioCtx;}
function playSound(type){
if(!soundEnabled)return;
try{const ctx=getAudioCtx();const osc=ctx.createOscillator();const gain=ctx.createGain();osc.connect(gain);gain.connect(ctx.destination);
if(type==='generate'){osc.type='sine';osc.frequency.setValueAtTime(600,ctx.currentTime);osc.frequency.exponentialRampToValueAtTime(1200,ctx.currentTime+.15);gain.gain.setValueAtTime(.1,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.3);osc.start();osc.stop(ctx.currentTime+.3);}
else if(type==='copy'){osc.type='sine';osc.frequency.setValueAtTime(1000,ctx.currentTime);osc.frequency.setValueAtTime(1400,ctx.currentTime+.08);gain.gain.setValueAtTime(.08,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.2);osc.start();osc.stop(ctx.currentTime+.2);}
else if(type==='fav'){osc.type='triangle';osc.frequency.setValueAtTime(800,ctx.currentTime);osc.frequency.exponentialRampToValueAtTime(1600,ctx.currentTime+.2);gain.gain.setValueAtTime(.08,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.3);osc.start();osc.stop(ctx.currentTime+.3);}
else if(type==='vote'){osc.type='square';osc.frequency.setValueAtTime(500,ctx.currentTime);osc.frequency.exponentialRampToValueAtTime(900,ctx.currentTime+.12);gain.gain.setValueAtTime(.05,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.2);osc.start();osc.stop(ctx.currentTime+.2);}
else{osc.type='sine';osc.frequency.setValueAtTime(800,ctx.currentTime);gain.gain.setValueAtTime(.05,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.08);osc.start();osc.stop(ctx.currentTime+.08);}
if(navigator.vibrate&&type!=='click')navigator.vibrate(type==='generate'?[30,20,30]:20);
}catch(e){}}

// ===== THEME =====
function initTheme(){if(lightMode){document.body.classList.add('light');toggleThemeIcons(true);}updateSoundBtn();}
function toggleTheme(){lightMode=!lightMode;document.body.classList.toggle('light',lightMode);toggleThemeIcons(lightMode);localStorage.setItem('rizzLight',JSON.stringify(lightMode));playSound('click');}
function toggleThemeIcons(isLight){const d=document.querySelector('.theme-icon-dark');const l=document.querySelector('.theme-icon-light');if(d)d.style.display=isLight?'none':'block';if(l)l.style.display=isLight?'block':'none';}
function toggleSound(){soundEnabled=!soundEnabled;localStorage.setItem('rizzSound',JSON.stringify(soundEnabled));updateSoundBtn();if(soundEnabled)playSound('click');}
function updateSoundBtn(){const b=document.getElementById('soundToggle');if(b)b.classList.toggle('muted',!soundEnabled);}

// ===== PWA =====
let deferredPrompt=null;
if('serviceWorker' in navigator)navigator.serviceWorker.register('sw.js').catch(()=>{});
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;const b=document.getElementById('pwaBanner');if(b&&!localStorage.getItem('rizzPwaDismissed'))b.style.display='block';});
function initPWA(){
document.getElementById('pwaInstallBtn')?.addEventListener('click',async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();await deferredPrompt.userChoice;deferredPrompt=null;document.getElementById('pwaBanner').style.display='none';});
document.getElementById('pwaCloseBtn')?.addEventListener('click',()=>{document.getElementById('pwaBanner').style.display='none';localStorage.setItem('rizzPwaDismissed','true');});
}

// ===== DROPDOWNS =====
function initDropdowns(){
document.querySelectorAll('.custom-select').forEach(sel=>{
const display=sel.querySelector('.select-display'),dropdown=sel.querySelector('.select-dropdown');
if(!display||!dropdown)return;
display.addEventListener('click',e=>{e.stopPropagation();document.querySelectorAll('.custom-select.open').forEach(s=>{if(s!==sel)s.classList.remove('open');});sel.classList.toggle('open');playSound('click');});
dropdown.querySelectorAll('.select-option').forEach(opt=>{opt.addEventListener('click',()=>{
dropdown.querySelectorAll('.select-option').forEach(o=>o.classList.remove('selected'));opt.classList.add('selected');
const icon=sel.querySelector('.select-icon');if(icon&&opt.dataset.icon)icon.textContent=opt.dataset.icon;
sel.querySelector('.select-text').textContent=opt.textContent.replace(/^[^\w]+/,'').trim();sel.classList.remove('open');
const v=opt.dataset.value;if(sel.id==='categorySelect')category=v;else if(sel.id==='styleSelect')style=v;else if(sel.id==='langSelect')lang=v;playSound('click');
});});});
document.addEventListener('click',()=>document.querySelectorAll('.custom-select.open').forEach(s=>s.classList.remove('open')));
}

function initIntensity(){document.querySelectorAll('.int-btn').forEach(b=>{b.addEventListener('click',()=>{document.querySelectorAll('.int-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');intensity=b.dataset.int;playSound('click');});});}

// ===== GENERATE =====
async function generateLines(){
const btn=document.getElementById('generateBtn');if(btn.classList.contains('loading'))return;btn.classList.add('loading');
const ctx=document.getElementById('contextInput')?.value||'';
try{
let lines=[];const dbCat=DB[category];
if(dbCat){const dbStyle=dbCat[style]||dbCat.smooth;const dbInt=dbStyle?.[intensity]||dbStyle?.bold||Object.values(dbStyle)[0];if(dbInt?.length)lines=[...dbInt].sort(()=>Math.random()-.5).slice(0,5);}
try{const ai=await callAI({category,style,lang,intensity,context:ctx,count:5});if(ai?.length)lines=ai;}catch(e){}
displayResults(lines);addToHistory(lines,category,style);playSound('generate');launchConfetti();
}catch(e){showToast('Failed to generate. Try again!');}btn.classList.remove('loading');
}
function displayResults(lines){
const c=document.getElementById('results');c.innerHTML='';
lines.forEach((line,i)=>{const isFav=favorites.includes(line);const d=document.createElement('div');d.className='result-item';d.style.animationDelay=`${i*.08}s`;
d.innerHTML=`<p class="result-text">${escHtml(line)}</p><div class="result-actions"><button class="result-action-btn copy-btn" onclick="copyLine(this,'${escAttr(line)}')">üìã Copy</button><button class="result-action-btn fav-toggle ${isFav?'fav-active':''}" onclick="toggleFav(this,'${escAttr(line)}')">‚ù§Ô∏è Save</button><button class="result-action-btn share-btn" onclick="openShareCard('${escAttr(line)}')">üì§ Share</button></div>`;c.appendChild(d);});
}

// ===== COPY / FAV =====
function copyLine(btn,text){navigator.clipboard.writeText(text).then(()=>{btn.textContent='‚úÖ Copied!';setTimeout(()=>btn.textContent='üìã Copy',1500);showToast('Copied!');playSound('copy');});}
function toggleFav(btn,text){const i=favorites.indexOf(text);if(i>-1){favorites.splice(i,1);btn.classList.remove('fav-active');}else{favorites.push(text);btn.classList.add('fav-active');playSound('fav');}localStorage.setItem('rizzFavs',JSON.stringify(favorites));updateFavCount();}
function updateFavCount(){const e=document.getElementById('favCount');if(e)e.textContent=favorites.length;}

// ===== FAV DRAWER =====
function openFavDrawer(){document.getElementById('favDrawer').classList.add('open');renderFavList();}
function closeFavDrawer(){document.getElementById('favDrawer').classList.remove('open');}
function renderFavList(){
const l=document.getElementById('favList');
if(!favorites.length){l.innerHTML='<div class="fav-empty">No saved lines yet. Start generating!</div>';return;}
l.innerHTML=favorites.map((f,i)=>`<div class="fav-item"><p class="fav-item-text">${escHtml(f)}</p><div class="fav-item-actions"><button class="fav-item-btn" onclick="copyLine(this,'${escAttr(f)}')">üìã Copy</button><button class="fav-item-btn" onclick="openShareCard('${escAttr(f)}')">üì§ Share</button><button class="fav-item-btn remove" onclick="removeFav(${i})">üóëÔ∏è</button></div></div>`).join('');
}
function removeFav(i){favorites.splice(i,1);localStorage.setItem('rizzFavs',JSON.stringify(favorites));renderFavList();updateFavCount();}

// ===== HISTORY =====
function addToHistory(lines,cat,sty){historyArr.unshift({id:Date.now(),timestamp:new Date().toISOString(),category:cat,style:sty,lines:[...lines]});if(historyArr.length>100)historyArr=historyArr.slice(0,100);localStorage.setItem('rizzHistory',JSON.stringify(historyArr));}
function openHistoryDrawer(){document.getElementById('historyDrawer').classList.add('open');renderHistoryList();}
function closeHistoryDrawer(){document.getElementById('historyDrawer').classList.remove('open');}
function renderHistoryList(filter=''){
const l=document.getElementById('historyList');
const filtered=filter?historyArr.filter(h=>h.lines.some(x=>x.toLowerCase().includes(filter.toLowerCase()))):historyArr;
if(!filtered.length){l.innerHTML='<div class="history-empty">No history yet. Start generating!</div>';return;}
const grouped={};filtered.forEach(h=>{const d=new Date(h.timestamp);const key=isToday(d)?'Today':isYesterday(d)?'Yesterday':d.toLocaleDateString();if(!grouped[key])grouped[key]=[];grouped[key].push(h);});
l.innerHTML=Object.entries(grouped).map(([day,entries])=>`<div class="history-group"><div class="history-group-title">${day}</div>${entries.map(e=>`<div class="history-item" onclick="this.querySelector('.history-item-actions').style.display=this.querySelector('.history-item-actions').style.display==='flex'?'none':'flex'"><div class="history-item-meta"><span class="history-item-tag">${e.category} ‚Ä¢ ${e.style}</span><span class="history-item-time">${new Date(e.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span></div><p class="history-item-text">${escHtml(e.lines[0]||'')}</p><div class="history-item-actions" style="display:none">${e.lines.map(x=>`<button class="fav-item-btn" onclick="event.stopPropagation();copyLine(this,'${escAttr(x)}')" title="${escAttr(x)}">üìã</button>`).join('')}</div></div>`).join('')}</div>`).join('');
}
function isToday(d){const t=new Date();return d.getDate()===t.getDate()&&d.getMonth()===t.getMonth()&&d.getFullYear()===t.getFullYear();}
function isYesterday(d){const t=new Date();t.setDate(t.getDate()-1);return d.getDate()===t.getDate()&&d.getMonth()===t.getMonth()&&d.getFullYear()===t.getFullYear();}

// ===== SHARE CARD =====
function openShareCard(text){document.getElementById('shareModal').style.display='flex';generateShareImage(text);}
function closeShareModal(){document.getElementById('shareModal').style.display='none';}
function generateShareImage(text){
const canvas=document.getElementById('shareCanvas');const ctx=canvas.getContext('2d');canvas.width=1080;canvas.height=1080;
const grad=ctx.createLinearGradient(0,0,1080,1080);grad.addColorStop(0,'#7c3aed');grad.addColorStop(.5,'#a855f7');grad.addColorStop(1,'#ec4899');
ctx.fillStyle=grad;ctx.fillRect(0,0,1080,1080);
ctx.fillStyle='rgba(0,0,0,0.1)';for(let i=0;i<8;i++){ctx.beginPath();ctx.arc(Math.random()*1080,Math.random()*1080,Math.random()*200+50,0,Math.PI*2);ctx.fill();}
ctx.fillStyle='rgba(255,255,255,0.05)';ctx.fillRect(60,60,960,960);
ctx.fillStyle='#fff';ctx.font='bold 44px Inter,system-ui,sans-serif';ctx.textAlign='center';
const words=text.split(' ');let lines=[],line='';
words.forEach(w=>{const test=line?line+' '+w:w;if(ctx.measureText(test).width>800){lines.push(line);line=w;}else line=test;});if(line)lines.push(line);
const lh=60,startY=540-(lines.length*lh)/2;
lines.forEach((l,i)=>{ctx.fillStyle='rgba(0,0,0,0.2)';ctx.fillText(l,542,startY+i*lh+2);ctx.fillStyle='#fff';ctx.fillText(l,540,startY+i*lh);});
ctx.fillStyle='rgba(255,255,255,0.5)';ctx.font='600 26px Inter,sans-serif';ctx.fillText('‚ö° RizzGPT',540,980);
const preview=document.getElementById('sharePreview');preview.src=canvas.toDataURL('image/png');
document.getElementById('shareDownload').onclick=()=>{const a=document.createElement('a');a.href=canvas.toDataURL('image/png');a.download='rizzgpt-card.png';a.click();playSound('copy');showToast('Card downloaded!');};
document.getElementById('shareNative').onclick=async()=>{try{canvas.toBlob(async blob=>{if(navigator.share)await navigator.share({files:[new File([blob],'rizzgpt-card.png',{type:'image/png'})],title:'RizzGPT',text});else{navigator.clipboard.writeText(text);showToast('Text copied!');}});playSound('copy');}catch(e){navigator.clipboard.writeText(text);showToast('Text copied!');}};
}

// ===== RIZZ SCORE =====
async function analyzeRizzScore(){
const input=document.getElementById('rizzScoreInput').value.trim();if(!input){showToast('Enter a message to analyze!');return;}
const btn=document.getElementById('analyzeRizzBtn');btn.classList.add('loading');
try{
const msgs=[{role:'system',content:'You are a Rizz Score Analyzer. Rate the message on rizz. Return ONLY valid JSON: {"score":75,"confidence":80,"creativity":70,"charm":75,"humor":60,"label":"Smooth Operator","verdict":"Brief analysis."} Score 0-100. Labels: 0-20="Needs CPR", 21-40="Rookie Rizzer", 41-60="Decent Game", 61-80="Smooth Operator", 81-95="Certified Rizz Lord", 96-100="Rizz God".'},{role:'user',content:`Rate this: "${input}"`}];
const text=await callAIRaw(msgs);const json=JSON.parse(text.match(/\{[\s\S]*\}/)?.[0]||'{}');displayRizzScore(json);playSound('generate');
}catch(e){displayRizzScore({score:Math.floor(Math.random()*40)+40,confidence:Math.floor(Math.random()*30)+50,creativity:Math.floor(Math.random()*30)+40,charm:Math.floor(Math.random()*30)+45,humor:Math.floor(Math.random()*30)+35,label:'Decent Game',verdict:'Shows some personality but could use more originality.'});}
btn.classList.remove('loading');
}
function displayRizzScore(data){
const result=document.getElementById('rizzScoreResult');result.style.display='block';
const svg=result.querySelector('.score-gauge');
if(!svg.querySelector('defs')){const defs=document.createElementNS('http://www.w3.org/2000/svg','defs');defs.innerHTML='<linearGradient id="gaugeGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#6366f1"/><stop offset="50%" stop-color="#a855f7"/><stop offset="100%" stop-color="#ec4899"/></linearGradient>';svg.prepend(defs);}
const fill=document.getElementById('gaugeFill');const circ=2*Math.PI*85;fill.style.strokeDasharray=circ;fill.style.strokeDashoffset=circ;
requestAnimationFrame(()=>{fill.style.strokeDashoffset=circ-(data.score/100)*circ;});
animateNum('scoreNumber',0,data.score,1200);document.getElementById('scoreLabel').textContent=data.label||'‚Äî';
document.getElementById('scoreBreakdown').innerHTML=['confidence','creativity','charm','humor'].map(k=>`<div class="breakdown-item"><div class="breakdown-label">${k}</div><div class="breakdown-bar"><div class="breakdown-bar-fill ${k}" style="width:0%"></div></div><div class="breakdown-value">${data[k]||0}/100</div></div>`).join('');
setTimeout(()=>{document.querySelectorAll('.breakdown-bar-fill').forEach(b=>{const k=b.className.split(' ').pop();b.style.width=(data[k]||0)+'%';});},100);
document.getElementById('scoreVerdict').innerHTML=`<p class="verdict-text">${data.verdict||''}</p>`;
}
function animateNum(id,from,to,dur){const el=document.getElementById(id);const s=performance.now();(function tick(now){const p=Math.min((now-s)/dur,1);el.textContent=Math.round(from+(to-from)*(1-Math.pow(1-p,3)));if(p<1)requestAnimationFrame(tick);})(s);}

// ===== VIBE CHECK =====
async function analyzeVibe(){
const input=document.getElementById('vibeInput').value.trim();if(!input){showToast('Enter a message to analyze!');return;}
const vctx=document.getElementById('vibeContext').value.trim();
const btn=document.getElementById('vibeCheckBtn');btn.classList.add('loading');
try{
const msgs=[{role:'system',content:'You are a Vibe Check Analyzer for dating. Return ONLY valid JSON: {"interest":7,"mood":"Playful","flirting":true,"energy":"High","analysis":"They seem interested.","flags":[{"type":"green","text":"Asks questions back"},{"type":"yellow","text":"Short replies"}],"suggestion":"Mirror their energy."}'},{role:'user',content:`Analyze this message I received${vctx?' (context: '+vctx+')':''}:\n"${input}"`}];
const text=await callAIRaw(msgs);const json=JSON.parse(text.match(/\{[\s\S]*\}/)?.[0]||'{}');displayVibeResult(json);playSound('generate');
}catch(e){displayVibeResult({interest:6,mood:'Curious',flirting:false,energy:'Medium',analysis:'Seems moderately interested.',flags:[{type:'green',text:'Responded'},{type:'yellow',text:'Brief reply'}],suggestion:'Ask an engaging question to get them invested.'});}
btn.classList.remove('loading');
}
function displayVibeResult(data){
const r=document.getElementById('vibeResult');r.style.display='block';
const interest=data.interest||5,cls=interest>=7?'high':interest>=4?'medium':'low';
document.getElementById('vibeMeters').innerHTML=`<div class="vibe-meter"><div class="vibe-meter-label">Interest</div><div class="vibe-meter-value ${cls}">${interest}/10</div><div class="vibe-meter-sub">${interest>=7?'Very Interested':interest>=4?'Moderate':'Low Interest'}</div></div><div class="vibe-meter"><div class="vibe-meter-label">Energy</div><div class="vibe-meter-value">${data.energy||'Medium'}</div><div class="vibe-meter-sub">${data.mood||'Neutral'} vibe</div></div><div class="vibe-meter"><div class="vibe-meter-label">Flirting?</div><div class="vibe-meter-value ${data.flirting?'high':'low'}">${data.flirting?'Yes üòè':'Nope'}</div><div class="vibe-meter-sub">${data.flirting?'Flirt signals detected':'Casual tone'}</div></div><div class="vibe-meter"><div class="vibe-meter-label">Mood</div><div class="vibe-meter-value">${data.mood||'Neutral'}</div><div class="vibe-meter-sub">Overall tone</div></div>`;
document.getElementById('vibeAnalysis').innerHTML=`<div class="vibe-analysis-title">Analysis</div><p class="vibe-analysis-text">${data.analysis||''}</p>`;
document.getElementById('vibeFlags').innerHTML=(data.flags||[]).map(f=>`<span class="vibe-flag ${f.type}">${f.type==='green'?'‚úÖ':f.type==='red'?'üö©':'‚ö†Ô∏è'} ${f.text}</span>`).join('');
document.getElementById('vibeSuggestion').innerHTML=`<div class="vibe-suggestion-title">üí° Suggested Move</div><p class="vibe-suggestion-text">${data.suggestion||''}</p>`;
}

// ===== RIZZ BATTLE =====
let battleLines={A:'',B:''},battleVoted=false;
async function newBattle(){
const btn=document.getElementById('newBattleBtn');btn.classList.add('loading');battleVoted=false;
document.querySelectorAll('.battle-vote-btn').forEach(b=>{b.classList.remove('voted');b.disabled=false;});
document.querySelectorAll('.battle-card').forEach(c=>c.classList.remove('winner','loser'));
const styles=['smooth','funny','romantic','bold','nerdy','poetic'];
const s1=styles[Math.floor(Math.random()*styles.length)];let s2=styles[Math.floor(Math.random()*styles.length)];while(s2===s1)s2=styles[Math.floor(Math.random()*styles.length)];
try{
const msgs=[{role:'system',content:`Generate 2 pickup lines. Line A: ${s1} style. Line B: ${s2} style. Return ONLY two lines, one per line. No numbers, labels, or quotes.`},{role:'user',content:'Generate 2 contrasting pickup lines.'}];
const text=await callAIRaw(msgs);const parsed=text.split('\n').map(l=>l.replace(/^\d+[.)\-:\s]*/,'').replace(/^["']/,'').replace(/["']$/,'').replace(/^Line\s*[AB]:?\s*/i,'').trim()).filter(l=>l.length>10);
battleLines.A=parsed[0]||getRandomDB(s1);battleLines.B=parsed[1]||getRandomDB(s2);
}catch(e){battleLines.A=getRandomDB(s1);battleLines.B=getRandomDB(s2);}
document.getElementById('battleTextA').textContent=battleLines.A;document.getElementById('battleTextB').textContent=battleLines.B;
document.querySelector('#battleLeft .battle-label').textContent=`üÖ∞Ô∏è ${cap(s1)}`;document.querySelector('#battleRight .battle-label').textContent=`üÖ±Ô∏è ${cap(s2)}`;
btn.classList.remove('loading');playSound('generate');
}
function voteBattle(side){
if(battleVoted)return;battleVoted=true;
battleStats.total=(battleStats.total||0)+1;localStorage.setItem('rizzBattle',JSON.stringify(battleStats));
document.getElementById('battleCount').textContent=`${battleStats.total} battles`;
document.getElementById('vote'+side).classList.add('voted');
document.getElementById(side==='A'?'battleLeft':'battleRight').classList.add('winner');
document.getElementById(side==='A'?'battleRight':'battleLeft').classList.add('loser');
document.querySelectorAll('.battle-vote-btn').forEach(b=>b.disabled=true);
playSound('vote');launchConfetti();
}
function getRandomDB(sty){const s=DB.pickup[sty]||DB.pickup.smooth;const p=s.bold||Object.values(s)[0]||[];return p[Math.floor(Math.random()*p.length)]||'Are you a magician?';}
function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}

// ===== DAILY CHALLENGE =====
const CHALLENGES=[
{prompt:"Rizz using only food references üçï",desc:"Every metaphor must involve food. The cheesier, the better."},
{prompt:"Movie-themed rizz only üé¨",desc:"Reference a famous movie or character."},
{prompt:"One-word opener challenge üí¨",desc:"A single powerful word that demands a response."},
{prompt:"Compliment without mentioning looks üß†",desc:"Make them feel special without referencing appearance."},
{prompt:"Rizz in exactly 5 words ‚úã",desc:"Maximum impact in exactly five words."},
{prompt:"Science-themed pickup lines üî¨",desc:"Use science concepts to create your line."},
{prompt:"Time traveler rizz ‚è∞",desc:"Pretend you're from the future."},
{prompt:"Reverse psychology rizz üîÑ",desc:"Use reverse psychology to be irresistible."},
{prompt:"Emoji-first then text üíå",desc:"Start with 3 mood-setting emojis, then the line."},
{prompt:"Roast-to-rizz pipeline üî•",desc:"Start with a light roast, end with a compliment."},
{prompt:"Song lyric remix üéµ",desc:"Remix a famous lyric into a pickup line."},
{prompt:"Animal-themed lines üêæ",desc:"Use animal references for cute or clever lines."},
{prompt:"Superhero rizz ü¶∏",desc:"Reference a superhero or superpower."},
{prompt:"Weather-themed flirting ‚õàÔ∏è",desc:"Use weather metaphors."},
{prompt:"Sports analogy rizz üèÄ",desc:"Score with a sports-themed line."},
{prompt:"Space & astronomy üåå",desc:"Out-of-this-world cosmic lines."},
{prompt:"History class rizz üìö",desc:"Reference historical events or figures."},
{prompt:"Math pickup lines üìê",desc:"Love is all about numbers."},
{prompt:"Social media themed üì±",desc:"Reference social media culture."},
{prompt:"Grammar nerd rizz ‚úèÔ∏è",desc:"Wordplay, puns, or grammar jokes."},
{prompt:"Coffee shop rizz ‚òï",desc:"Perfect line for a coffee shop setting."},
{prompt:"Late night text rizz üåô",desc:"The perfect 11 PM bold text."},
{prompt:"Bookworm rizz üìñ",desc:"Reference a famous book or character."},
{prompt:"Gym rizz üí™",desc:"Fitness-themed pickup line."},
{prompt:"Coding pickup lines üíª",desc:"Lines only a programmer would love."},
{prompt:"Art museum rizz üé®",desc:"Paint a picture with your words."},
{prompt:"Travel-themed rizz ‚úàÔ∏è",desc:"Take them on a journey."},
{prompt:"Zodiac sign rizz ‚ôà",desc:"Astrology-based charm."},
{prompt:"Cooking rizz üë®‚Äçüç≥",desc:"You're the chef of love."},
{prompt:"Adventure opener üèîÔ∏è",desc:"Invite someone on an adventure."},
{prompt:"Holiday special üéÑ",desc:"Theme around any holiday."}
];
function getDailyChallenge(){const d=new Date();return CHALLENGES[Math.floor((d-new Date(d.getFullYear(),0,0))/(864e5))%CHALLENGES.length];}
function initChallenge(){
const ch=getDailyChallenge(),today=new Date().toDateString();
document.getElementById('challengePrompt').textContent=ch.prompt;
document.getElementById('challengeDesc').textContent=ch.desc;
document.getElementById('challengeDate').textContent=new Date().toLocaleDateString([],{weekday:'long',month:'short',day:'numeric'});
document.getElementById('streakCount').textContent=calcStreak();
if(challengeData.completedDate===today){
document.getElementById('challengeGenBtn').textContent='‚úÖ Completed!';document.getElementById('challengeGenBtn').style.opacity='.6';
if(challengeData.results){const r=document.getElementById('challengeResults');r.style.display='block';r.innerHTML=challengeData.results.map(x=>`<div class="result-item"><p class="result-text">${escHtml(x)}</p><div class="result-actions"><button class="result-action-btn copy-btn" onclick="copyLine(this,'${escAttr(x)}')">üìã Copy</button><button class="result-action-btn share-btn" onclick="openShareCard('${escAttr(x)}')">üì§ Share</button></div></div>`).join('');}
}
}
function calcStreak(){if(!challengeData.lastCompleted)return 0;const diff=Math.floor((new Date()-new Date(challengeData.lastCompleted))/864e5);return diff>1?0:challengeData.streak||0;}
async function generateChallenge(){
const today=new Date().toDateString();if(challengeData.completedDate===today){showToast('Already completed today!');return;}
const ch=getDailyChallenge(),btn=document.getElementById('challengeGenBtn');btn.classList.add('loading');
try{
let lines;try{const msgs=[{role:'system',content:'You are RizzGPT. Generate 3 creative lines for this challenge. Match the theme. Return 3 lines, one per line. No numbers.'},{role:'user',content:`Challenge: ${ch.prompt}\n${ch.desc}\nGenerate in hinglish.`}];lines=parseAIResponse(await callAIRaw(msgs),3);}catch(e){lines=['Challenge accepted ‚Äî loading your rizz!','Your charm level is charging...','Try again for AI-powered results!'];}
const r=document.getElementById('challengeResults');r.style.display='block';
r.innerHTML=lines.map(x=>`<div class="result-item"><p class="result-text">${escHtml(x)}</p><div class="result-actions"><button class="result-action-btn copy-btn" onclick="copyLine(this,'${escAttr(x)}')">üìã Copy</button><button class="result-action-btn share-btn" onclick="openShareCard('${escAttr(x)}')">üì§ Share</button></div></div>`).join('');
let streak=challengeData.streak||0;const prev=challengeData.lastCompleted?new Date(challengeData.lastCompleted):null;
streak=prev&&Math.floor((new Date()-prev)/864e5)<=1?streak+1:1;
challengeData={completedDate:today,lastCompleted:new Date().toISOString(),streak,results:lines};
localStorage.setItem('rizzChallenge',JSON.stringify(challengeData));
document.getElementById('streakCount').textContent=streak;btn.textContent='‚úÖ Completed!';btn.style.opacity='.6';
playSound('generate');launchConfetti();
}catch(e){showToast('Failed. Try again!');}btn.classList.remove('loading');
}

// ===== GEN TABS =====
function initTabs(){document.querySelectorAll('.gen-tab').forEach(tab=>{tab.addEventListener('click',()=>{document.querySelectorAll('.gen-tab').forEach(t=>t.classList.remove('active'));tab.classList.add('active');document.querySelectorAll('.gen-panel').forEach(p=>p.classList.remove('active'));const panel=document.getElementById('panel'+cap(tab.dataset.tab));if(panel)panel.classList.add('active');playSound('click');});});}

// ===== AI =====
async function callAI(opts){
const sys=`You are RizzGPT. Generate ${opts.count||5} ${opts.style} ${opts.category} lines. Intensity: ${opts.intensity}. Language: ${opts.lang==='hinglish'?'Hinglish (Hindi+English casual texting)':opts.lang}.${opts.context?' Context: '+opts.context:''} Return ONLY lines, one per line. No numbering.`;
const messages=[{role:'system',content:sys},{role:'user',content:`Generate ${opts.count||5} ${opts.intensity} ${opts.style} ${opts.category} lines.`}];
let lastErr;for(const p of providers){if(!p.enabled())continue;try{const t=await Promise.race([p.call(messages),new Promise((_,r)=>setTimeout(()=>r(new Error('timeout')),15000))]);if(!t||t.trim().length<5)throw new Error('empty');return parseAIResponse(t,opts.count);}catch(e){lastErr=e;}}throw lastErr||new Error('All failed');
}
async function callAIRaw(messages){let lastErr;for(const p of providers){if(!p.enabled())continue;try{const t=await Promise.race([p.call(messages),new Promise((_,r)=>setTimeout(()=>r(new Error('timeout')),15000))]);if(!t||t.trim().length<5)throw new Error('empty');return t;}catch(e){lastErr=e;}}throw lastErr||new Error('All failed');}
function parseAIResponse(text,count){return text.split('\n').map(l=>l.replace(/^\d+[.)\-:\s]+/,'').replace(/^"/,'').replace(/"$/,'').trim()).filter(l=>l.length>5&&!l.startsWith('#')&&!l.startsWith('*')&&!l.toLowerCase().startsWith('here')&&!l.toLowerCase().startsWith('sure')).slice(0,count||5);}

// ===== CONFETTI =====
function launchConfetti(){const w=document.getElementById('confettiWrap');const colors=['#a855f7','#ec4899','#6366f1','#f59e0b','#22c55e'];for(let i=0;i<30;i++){const c=document.createElement('div');c.className='confetti';c.style.left=Math.random()*100+'%';c.style.top='-10px';c.style.background=colors[Math.floor(Math.random()*colors.length)];c.style.animationDelay=Math.random()*.5+'s';c.style.width=(Math.random()*6+4)+'px';c.style.height=(Math.random()*6+4)+'px';w.appendChild(c);setTimeout(()=>c.remove(),2000);}}

// ===== TOAST =====
function showToast(msg){const t=document.getElementById('toast');document.getElementById('toastText').textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}

// ===== UTILS =====
function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function escAttr(s){return s.replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/"/g,'&quot;');}

// ===== MENU =====
function initMenu(){document.getElementById('menuBtn')?.addEventListener('click',()=>{document.getElementById('navLinks').classList.toggle('open');playSound('click');});}

// ===== INIT =====
document.addEventListener('DOMContentLoaded',()=>{
initTheme();initPWA();initMenu();initDropdowns();initIntensity();initTabs();initChallenge();updateFavCount();
document.getElementById('generateBtn')?.addEventListener('click',generateLines);
document.getElementById('favBtn')?.addEventListener('click',openFavDrawer);
document.getElementById('historyBtn')?.addEventListener('click',openHistoryDrawer);
document.getElementById('themeToggle')?.addEventListener('click',toggleTheme);
document.getElementById('soundToggle')?.addEventListener('click',toggleSound);
document.getElementById('analyzeRizzBtn')?.addEventListener('click',analyzeRizzScore);
document.getElementById('vibeCheckBtn')?.addEventListener('click',analyzeVibe);
document.getElementById('newBattleBtn')?.addEventListener('click',newBattle);
document.getElementById('voteA')?.addEventListener('click',()=>voteBattle('A'));
document.getElementById('voteB')?.addEventListener('click',()=>voteBattle('B'));
document.getElementById('challengeGenBtn')?.addEventListener('click',generateChallenge);
document.getElementById('clearHistoryBtn')?.addEventListener('click',()=>{historyArr=[];localStorage.setItem('rizzHistory','[]');renderHistoryList();showToast('History cleared!');});
document.getElementById('historySearch')?.addEventListener('input',e=>renderHistoryList(e.target.value));
document.getElementById('battleCount').textContent=`${battleStats.total||0} battles`;
newBattle();
});
